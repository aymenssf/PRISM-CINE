<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRISM â€” Cinematic Intelligence</title>
    <meta name="description"
        content="Prism: Your personal cinematic universe, decoded. Real-time discovery powered by distributed intelligence.">

    <!-- Fonts: Inter + JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'monospace'],
                    },
                    colors: {
                        neutral: {
                            950: '#0a0a0a',
                        },
                        jade: {
                            400: '#4ade80',
                            500: '#22c55e',
                        },
                        danger: {
                            500: '#ef4444',
                        }
                    },
                    backgroundImage: {
                        'grid-white': "linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px)",
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scanline': 'scanline 8s linear infinite',
                    },
                    keyframes: {
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
            background-size: 40px 40px;
        }

        /* Noise Texture */
        .noise-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 50;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
        }

        /* Scanline Effect */
        .scanline::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 40;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body
    class="bg-neutral-950 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:24px_24px] text-white min-h-screen flex flex-col font-sans selection:bg-white/20 selection:text-white overflow-x-hidden antialiased">

    <!-- Noise Overlay -->
    <div class="noise-bg"></div>

    <!-- Scanline Overlay (Optional, added class 'scanline' to body if needed, currently just keeping css ready) -->
    <!-- <div class="scanline fixed inset-0 pointer-events-none z-40"></div> -->

    <!-- Dynamic Island Header -->
    <div class="fixed top-6 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 ease-out group">
        <div id="dynamic-island" class="
            {% if current_boost %}
                w-auto px-6 py-2 bg-neutral-900/90 backdrop-blur-xl border border-red-500/20 shadow-[0_0_30px_rgba(220,38,38,0.3)]
            {% else %}
                 w-32 hover:w-48 h-2 bg-neutral-800/50 backdrop-blur-sm rounded-full border border-white/5 hover:bg-neutral-800 transition-all duration-300 overflow-hidden
            {% endif %}
            rounded-full flex items-center justify-center gap-3
        ">
            {% if current_boost %}
            <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
            </span>
            <span class="font-mono text-xs font-bold tracking-widest text-red-400 whitespace-nowrap">
                TREND DETECTED: {{ current_boost|upper }}
            </span>
            {% else %}
            <!-- Nominal State (Hidden/Minimal) -->
            <span
                class="opacity-0 group-hover:opacity-100 text-[9px] text-neutral-500 font-mono tracking-widest transition-opacity duration-300 whitespace-nowrap">PRISM
                SYSTEMS ONLINE</span>
            {% endif %}
        </div>
    </div>


    <!-- Main Content -->
    <main class="flex-1 w-full max-w-[1400px] mx-auto px-6 py-24 relative z-10">
        {% block content %}{% endblock %}
    </main>

    <!-- Terminal Footer (Status Bar) -->
    <footer class="fixed bottom-0 left-0 right-0 bg-neutral-950 border-t border-white/10 py-1 z-50">
        <div
            class="w-full px-4 flex items-center justify-between text-[10px] font-mono uppercase tracking-wider text-neutral-500">
            <!-- Left: Modules Status -->
            <div class="flex items-center gap-6">
                <!-- Ray Cluster -->
                <div class="flex items-center gap-2">
                    <span
                        class="w-1.5 h-1.5 rounded-sm {{ 'bg-emerald-500 shadow-[0_0_5px_rgba(16,185,129,0.8)]' if system_health.ray else 'bg-red-500' }}"></span>
                    <span class="{{ 'text-emerald-500' if system_health.ray else 'text-red-500' }}">PRISM_CORE</span>
                </div>

                <!-- XMPP Bus -->
                <div class="flex items-center gap-2">
                    <span
                        class="w-1.5 h-1.5 rounded-sm {{ 'bg-indigo-500 shadow-[0_0_5px_rgba(99,102,241,0.8)]' if system_health.xmpp else 'bg-red-500' }}"></span>
                    <span class="{{ 'text-indigo-500' if system_health.xmpp else 'text-red-500' }}">UPLINK</span>
                </div>

                <!-- JADE Agent -->
                <div class="flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-sm bg-amber-500 shadow-[0_0_5px_rgba(245,158,11,0.8)]"></span>
                    <span class="text-amber-500">AGENT: {{ system_health.jade_agent|upper }}</span>
                </div>
            </div>

            <!-- Center: Coordinates/Version -->
            <div class="hidden md:block opacity-50">
                PRISM v2.4 // CONNECTED TO CLUSTER
            </div>

            <!-- Right: Metrics -->
            <div class="flex items-center gap-4">
                <span>LATENCY: <span class="text-white">12ms</span></span>
                <span>HR: <span class="text-white">{{ "%.2f"|format(stats.total_ratings / (stats.total_users + 1))
                        }}</span></span>
            </div>
        </div>
    </footer>

</body>

</html>